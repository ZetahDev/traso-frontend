---
// Middleware básico de autenticación para gestión electoral
const password = "traso2025"; // Cambiar por una contraseña segura

// Verificar si ya está autenticado
const isAuthenticated = Astro.cookies.get("auth")?.value === "true";

// Si no está autenticado y no está enviando el formulario
if (!isAuthenticated && Astro.request.method !== "POST") {
  // Mostrar formulario de login
}

// Procesar login
if (Astro.request.method === "POST") {
  const formData = await Astro.request.formData();
  const inputPassword = formData.get("password");

  if (inputPassword === password) {
    Astro.cookies.set("auth", "true", {
      path: "/",
      maxAge: 60 * 60 * 24, // 24 horas
      httpOnly: true,
    });
    return Astro.redirect("/gestion-electoral");
  }
}
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Acceso - TRASO</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        background: linear-gradient(135deg, #2d4373 0%, #1e2d4f 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .login-container {
        background: white;
        padding: 3rem;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 400px;
        text-align: center;
      }

      .logo {
        width: 200px;
        margin-bottom: 2rem;
      }

      h1 {
        color: #2d4373;
        margin-bottom: 0.5rem;
        font-size: 1.5rem;
      }

      p {
        color: #666;
        margin-bottom: 2rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
        text-align: left;
      }

      label {
        display: block;
        color: #333;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      input {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s;
      }

      input:focus {
        outline: none;
        border-color: #2d4373;
      }

      .btn-submit {
        width: 100%;
        padding: 1rem 2rem;
        background: linear-gradient(135deg, #2d4373 0%, #1e2d4f 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .btn-submit:hover {
        transform: translateY(-2px);
      }

      .error {
        background: #fee;
        color: #c00;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        border: 1px solid #fcc;
      }

      .back-link {
        display: inline-block;
        margin-top: 1.5rem;
        color: #2d4373;
        text-decoration: none;
        font-weight: 500;
      }

      .back-link:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="login-container">
      <img src="/logo.png" alt="TRASO" class="logo" />
      <h1>Gestión Electoral</h1>
      <p>Acceso restringido - Solo administradores</p>

      {
        Astro.request.method === "POST" && (
          <div class="error">Contraseña incorrecta</div>
        )
      }

      <form method="POST">
        <div class="form-group">
          <label for="password">Contraseña</label>
          <input
            type="password"
            id="password"
            name="password"
            required
            autofocus
            placeholder="Ingrese su contraseña"
          />
        </div>
        <button type="submit" class="btn-submit">Ingresar</button>
      </form>

      <a href="/" class="back-link">← Volver al inicio</a>
    </div>
  </body>
</html>
